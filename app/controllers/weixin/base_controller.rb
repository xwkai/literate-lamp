# encoding: UTF-8
class Weixin::BaseController < ApplicationController

  before_action :bind_session,:only => [:show]

  private

  def bind_session
    code = params[:code]
    url="https://api.weixin.qq.com/sns/oauth2/access_token?appid=#{WeixinSetting.corpId}&secret=#{WeixinSetting.secret}&code=#{code}&grant_type=authorization_code"
    result = Base.http_request(url,'Post',nil)
    session[:openid] = result['openid'] if session[:openid].blank?
  end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       

end